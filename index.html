<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JOLIE PAS CHER</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#5D5CDE',
            secondary: '#FFD700',
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen transition-colors duration-300 bg-gradient-to-br from-blue-600 via-cyan-400 to-blue-600 dark:from-blue-900 dark:via-cyan-900 dark:to-blue-900">

<!-- Loading Screen -->
<div id="loading-screen" class="fixed inset-0 z-[10000] bg-gradient-to-br from-blue-600 via-cyan-400 to-blue-600 dark:from-blue-900 dark:via-cyan-900 dark:to-blue-900 flex items-center justify-center">
  <div class="text-center">
    <img src="https://i.postimg.cc/9Xx6XHrD/Screenshot-20250525-094331.png" alt="Logo" class="w-32 h-32 mx-auto mb-8 animate-bounce">
    <h1 class="text-5xl md:text-6xl font-bold text-white mb-4 drop-shadow-2xl">JOLIE PAS CHER</h1>
    <p class="text-xl text-white/90 mb-8">Chargement en cours...</p>
    <div class="flex justify-center gap-2">
      <div class="w-4 h-4 bg-yellow-400 rounded-full animate-pulse" style="animation-delay: 0s"></div>
      <div class="w-4 h-4 bg-yellow-400 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
      <div class="w-4 h-4 bg-yellow-400 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
    </div>
  </div>
</div>

<!-- Header -->
<header class="sticky top-0 z-50 bg-white dark:bg-gray-800 shadow-lg transition-colors duration-300">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <img src="https://i.postimg.cc/9Xx6XHrD/Screenshot-20250525-094331.png" alt="Logo" class="h-12 w-12 object-contain">
      <h1 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">JOLIE PAS CHER</h1>
    </div>

    <button onclick="toggleMenu()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
      <svg class="w-6 h-6 text-gray-900 dark:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>

  <!-- Menu -->
  <div id="menu" class="hidden bg-gradient-to-b from-gray-900 to-blue-900 text-white">
    <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col gap-2">
      <button onclick="showSection('accueil')" class="px-4 py-3 rounded-lg hover:bg-white/10 transition-all text-left text-base">üè† Accueil</button>
      <button onclick="showSection('boutique')" class="px-4 py-3 rounded-lg hover:bg-white/10 transition-all text-left text-base">üõçÔ∏è Boutique</button>
      <button onclick="showSection('panier')" class="px-4 py-3 rounded-lg hover:bg-white/10 transition-all text-left text-base">üõí Panier</button>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 py-8">

  <!-- Section Accueil -->
  <section id="accueil" class="section active">
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 drop-shadow-lg">Bienvenue sur Jolie Pas Cher</h1>
      <p class="text-xl md:text-2xl text-white/90">D√©couvrez des produits <strong>uniques</strong> √† petit prix !</p>
    </div>

    <div class="flex justify-center mb-8">
      <a href="https://poe.com/Har22fragpt" target="_blank" class="px-6 py-3 bg-blue-600 hover:bg-yellow-400 text-white hover:text-gray-900 rounded-lg font-bold text-base md:text-lg transition-all transform hover:scale-105 shadow-lg uppercase">
        üí¨ Discute avec le S (sur Poe)
      </a>
    </div>

    <div class="flex justify-center mb-8">
      <iframe
        src="https://www.instagram.com/reel/DGvmGEgNK-c/embed/?autoplay=1&hidecaption=1&controls=0"
        width="400"
        height="350"
        frameborder="0"
        scrolling="no"
        allow="autoplay; encrypted-media"
        class="rounded-lg shadow-2xl max-w-full">
      </iframe>
    </div>

    <div class="space-y-6 bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 md:p-8">
      <h2 class="text-3xl font-bold text-yellow-400 text-center mb-6">üéµ Meilleures Musiques</h2>

      <div class="space-y-4">
        <div class="bg-white/5 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-white mb-2">Frank le b≈ìuf</h3>
          <iframe width="100%" height="60" src="https://vocaroo.com/embed/1omwth55KSLT?autoplay=1" frameborder="0" allow="autoplay" class="rounded"></iframe>
        </div>

        <div class="bg-white/5 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-white mb-2">Band organise samba</h3>
          <iframe width="100%" height="60" src="https://vocaroo.com/embed/1ghiDBHLVRtn?autoplay=0" frameborder="0" allow="autoplay" class="rounded"></iframe>
        </div>

        <div class="bg-white/5 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-white mb-2">Journal 2 20h02</h3>
          <iframe width="100%" height="60" src="https://vocaroo.com/embed/1bKOLORGf4GO?autoplay=0" frameborder="0" allow="autoplay" class="rounded"></iframe>
        </div>

        <div class="bg-white/5 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-white mb-2">Vendez votre Frank Leb≈ìuf</h3>
          <iframe width="100%" height="60" src="https://vocaroo.com/embed/1fLLgpWY9xxo?autoplay=0" frameborder="0" allow="autoplay" class="rounded"></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- Section Boutique -->
  <section id="boutique" class="section">
    <div class="mb-8 text-center">
      <input
        type="text"
        id="recherche"
        oninput="filtrerArticles()"
        placeholder="üîç Rechercher un article..."
        class="w-full max-w-md px-6 py-3 rounded-full border-2 border-white/30 bg-white/90 dark:bg-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary shadow-lg">
    </div>

    <div id="articles-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
  </section>

  <!-- Section Panier -->
  <section id="panier" class="section">
    <h2 class="text-3xl md:text-4xl font-bold text-white text-center mb-8">üõí Votre panier</h2>

    <!-- Login Section -->
    <div id="login-section" class="mb-8 space-y-6">
      <div class="bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 md:p-8 text-center">
        <h3 class="text-2xl font-bold text-yellow-400 mb-4">üîç Connexion rapide par QR Code</h3>
        <p class="text-white mb-6">Scannez votre QR code personnel pour vous connecter automatiquement !</p>
        <button onclick="startQRScanner()" class="px-6 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-full text-base md:text-lg font-bold hover:scale-105 transition-transform shadow-lg">
          üì∑ Scanner QR Code
        </button>
      </div>

      <div class="text-center">
        <button onclick="toggleClassicLogin()" class="px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg border border-white/30 transition-all">
          üîë Connexion classique
        </button>

        <form id="classic-login-form" class="hidden mt-4 max-w-sm mx-auto bg-white/10 backdrop-blur-sm rounded-lg p-6 space-y-4" onsubmit="handleClassicLogin(event)">
          <input name="identifiant" type="text" placeholder="Identifiant" required class="w-full px-4 py-2 rounded-lg border-none bg-white dark:bg-gray-800 dark:text-white text-base focus:ring-2 focus:ring-primary">
          <input name="motDePasse" type="password" placeholder="Mot de passe" required class="w-full px-4 py-2 rounded-lg border-none bg-white dark:bg-gray-800 dark:text-white text-base focus:ring-2 focus:ring-primary">
          <button type="submit" class="w-full px-4 py-2 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold rounded-lg transition-colors">Se connecter</button>
          <div id="login-error" class="text-red-400 text-sm"></div>
        </form>
      </div>
    </div>

    <!-- QR Code Verification Overlay -->
    <div id="qr-code-verification-overlay" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
      <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 md:p-8 max-w-md w-full">
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">üîí V√©rification du code secret</h3>
        <p id="qr-user-prompt" class="text-gray-700 dark:text-gray-300 mb-6">Veuillez entrer votre code secret.</p>
        <form id="qr-verify-form" onsubmit="handleQRVerify(event)" class="space-y-4">
          <input type="password" id="qr-secret-code" placeholder="Code Secret" required class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white text-base focus:ring-2 focus:ring-primary">
          <button type="submit" class="w-full px-4 py-2 bg-primary hover:bg-primary/80 text-white font-bold rounded-lg transition-colors">Valider le Code</button>
          <div id="qr-verify-error" class="text-red-500 text-sm"></div>
        </form>
        <button onclick="cancelQRVerify()" class="w-full mt-4 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
          ‚ùå Annuler
        </button>
      </div>
    </div>

    <!-- QR Scanner Overlay -->
    <div id="qr-scanner-overlay" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4">
      <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 md:p-8 max-w-lg w-full">
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center">üîç Scanner votre QR Code</h3>
        <div class="relative w-full max-w-sm mx-auto mb-6">
          <div class="relative border-4 border-green-500 rounded-2xl overflow-hidden aspect-square">
            <video id="qr-video" autoplay playsinline class="w-full h-full object-cover"></video>
            <canvas id="qr-canvas" class="hidden"></canvas>
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
              <div class="w-48 h-48 border-2 border-green-500 rounded-xl shadow-[0_0_0_9999px_rgba(0,0,0,0.3)] animate-pulse"></div>
            </div>
          </div>
        </div>
        <p id="scan-message" class="text-center text-gray-700 dark:text-gray-300 font-semibold mb-4">Initialisation...</p>
        <button onclick="stopQRScanner()" class="w-full px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg transition-colors">
          ‚ùå Fermer
        </button>
      </div>
    </div>

    <!-- User Dashboard -->
    <div id="user-dashboard" class="hidden mb-8 space-y-6">
      <div class="bg-green-500/20 border-l-4 border-green-500 rounded-lg p-4 md:p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="text-white">
          <p class="text-base md:text-lg">‚úÖ Connect√© en tant que: <strong id="user-name" class="text-yellow-400"></strong></p>
          <p class="text-base md:text-lg">üí∞ Solde: <strong id="user-balance" class="text-yellow-400"></strong> cailloux</p>
        </div>
        <button onclick="logout()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors self-start md:self-auto">
          üö™ D√©connexion
        </button>
      </div>

      <div class="bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6">
        <h3 class="text-xl font-bold text-yellow-400 mb-4">üí∏ Envoyer des cailloux</h3>
        <form onsubmit="envoyerCailloux(event)" class="flex flex-col md:flex-row gap-3">
          <input name="destinataire" type="text" placeholder="Identifiant du destinataire" required class="flex-1 px-4 py-2 rounded-lg border-none bg-white dark:bg-gray-800 dark:text-white text-base focus:ring-2 focus:ring-primary">
          <input name="montant" type="number" placeholder="Montant" min="1" required class="flex-1 px-4 py-2 rounded-lg border-none bg-white dark:bg-gray-800 dark:text-white text-base focus:ring-2 focus:ring-primary">
          <button type="submit" class="px-6 py-2 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold rounded-lg transition-colors">Envoyer</button>
        </form>
      </div>

      <div class="bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6">
        <h3 class="text-xl font-bold text-yellow-400 mb-4">üé´ Code Cr√©ateur</h3>
        <input type="text" placeholder="Entrez le code cr√©ateur" onkeypress="handleCodeInput(event)" class="w-full px-4 py-2 rounded-lg border-none bg-white dark:bg-gray-800 dark:text-white text-base focus:ring-2 focus:ring-primary">
        <div id="code-success" class="hidden mt-3 text-green-400 font-bold"></div>
      </div>
    </div>

    <!-- Cart Content -->
    <div class="bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 md:p-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-white">üõí Articles dans le panier</h3>
        <button id="clear-cart-button" onclick="viderPanier()" class="hidden px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all text-sm">
          üóëÔ∏è Vider
        </button>
      </div>
      <div id="empty-cart" class="text-center text-white/70 italic py-8">Votre panier est vide</div>
      <ul id="liste-panier" class="hidden space-y-2 mb-6"></ul>
      <p id="total-panier" class="hidden text-2xl font-bold text-yellow-400 text-center mb-6">Total : 0 cailloux</p>
      <button id="buy-button" onclick="acheter()" class="hidden w-full md:w-auto mx-auto block px-8 py-3 bg-gradient-to-r from-red-500 to-cyan-500 text-white font-bold rounded-full text-base md:text-lg hover:scale-105 transition-transform shadow-lg">
        üí≥ Acheter
      </button>
    </div>

    <!-- Historique des commandes -->
    <div id="order-history" class="hidden mt-8 bg-white/10 dark:bg-black/20 backdrop-blur-sm rounded-2xl p-6 md:p-8">
      <h3 class="text-2xl font-bold text-white mb-6">üìú Historique de vos commandes</h3>
      <div id="history-list"></div>
    </div>
  </section>

</main>

<!-- Modal Container -->
<div id="modal-container"></div>

<style>
  .section {
    display: none;
  }
  .section.active {
    display: block;
  }
</style>

<script>
// Dark mode setup
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
  document.documentElement.classList.add('dark');
}
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
  if (event.matches) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }
});

// Variables globales
let panier = [];
let utilisateurConnecte = null;
let codeValide = false;
let reduction = 0;
let qrScannerActive = false;
let animationId = null;
let tempQRUser = null;
let historique = {};

// Fonction pour g√©n√©rer un num√©ro de commande al√©atoire
function genererNumeroCommande() {
  const prefix = 'JPC'; // JOLIE PAS CHER
  const timestamp = Date.now().toString().slice(-6); // 6 derniers chiffres du timestamp
  const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
  return `${prefix}-${timestamp}-${random}`;
}

// Sauvegarder le panier
function sauvegarderPanier() {
  updateCartBadge();
}

// Mettre √† jour le badge du panier
function updateCartBadge() {
  const totalItems = panier.reduce((sum, item) => sum + item.quantit√©, 0);
  let badge = document.getElementById('cart-badge');

  if (!badge && totalItems > 0) {
    badge = document.createElement('span');
    badge.id = 'cart-badge';
    badge.className = 'absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center animate-bounce';
    document.querySelector('button[onclick="showSection(\'panier\')"]').style.position = 'relative';
    document.querySelector('button[onclick="showSection(\'panier\')"]').appendChild(badge);
  }

  if (badge) {
    badge.textContent = totalItems;
    if (totalItems === 0) {
      badge.remove();
    }
  }
}

// Syst√®me de notifications toast
function showToast(message, type = 'info') {
  const colors = {
    success: 'bg-green-500',
    error: 'bg-red-500',
    info: 'bg-blue-500',
    warning: 'bg-yellow-500'
  };

  const toast = document.createElement('div');
  toast.className = `fixed top-24 right-4 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-2xl z-[9999] transform translate-x-[400px] transition-all duration-500 max-w-sm`;
  toast.innerHTML = `
    <div class="flex items-center gap-3">
      <span class="text-2xl">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
      <p class="font-semibold">${message}</p>
    </div>
  `;

  document.body.appendChild(toast);

  setTimeout(() => {
    toast.style.transform = 'translateX(0)';
  }, 100);

  setTimeout(() => {
    toast.style.transform = 'translateX(400px)';
    setTimeout(() => toast.remove(), 500);
  }, 3000);
}

const webhookURL = "https://discord.com/api/webhooks/1380578654093971527/50tQAtRKwQH0Fmktz1EunnhfJKyIbaBnXosQFRJGnCrNcp8BlvBHZWF7SXoFW3KzElfR";

const codes = {
  "OUI": 10,
  "UNCHAINED": 10,
  "CAMILLE": 20,
  "VIVLESSCOOTERETMAZDANIQUELESSALOPESQUIPARLENTENSCREDICICMARSEILLELARUELAVRAIVIVELESONOMATOPE": 30,
  "WSXBOEXNE01IXR3738Z9F2ONF7CN48383Y8D8D9EJ22I29DLDNSLLSMDCF7R783839399ECBF5R9012NNDKDLDODO": 40,
  "E9WBE9D3D83D4VDU4D5DUI8D0EH34J84KEVRI39DB38EOEBED9DJEJE0ZL'ZAMAMDVDUD9EO3282O393O3BDIZOZOZKDKEJC4U48388FIFUFUFUD6754F7F93B3BB33901010JKSSBZJZ9ZO": 99
};

const utilisateurs = {
  "HARMAN": { solde: 100000000000, motDePasse: "1234" },
  "ALEXANDRE": { solde: 100000000, motDePasse: "bonjour" },
  "ADMIN": { solde: 999999999999, motDePasse: "Dasntesreve" },
  "MAXIME": { solde: 10, motDePasse: "football" },
  "GABRIEL": { solde: 10, motDePasse: "con" },
  "ELWEN": { solde: 10, motDePasse: "5678" },
  "PANA": { solde: 10, motDePasse: "Salut" },
  "ENEA": { solde: 10, motDePasse: "Messi" },
  "CHARLIE": { solde: 10, motDePasse: "1328" },
  "LOUIS": { solde: 110, motDePasse: "Loup" },
  "GANZAGUE": { solde: 10, motDePasse: "Algue" },
  "HUGO": { solde: 10, motDePasse: "salut123" },
  "LENNY": { solde: 10, motDePasse: "coucou" },
  "GREGOIRE": { solde: 10, motDePasse: "argent" },
  "SULLIVAN": { solde: 10, motDePasse: "Barca" },
  "WAYS": { solde: 10, motDePasse: "colle" },
  "CAMILLE": { solde: 10, motDePasse: "fille" },
  "MATHIEU": { solde: 10, motDePasse: "Banane" },
  "GURMAN": { solde: 10, motDePasse: "Gourmand" },
  "NOELIE": { solde: 10600, motDePasse: "Super" },
  "VICTOR": { solde: 1600, motDePasse: "frites" }
};

const qrSecretCodes = {
  "HARMAN": "220112",
  "ALEXANDRE": "111111",
  "ADMIN": "000000",
  "MAXIME": "222222",
  "GABRIEL": "333333",
  "ELWEN": "444444",
  "PANA": "555555",
  "CAMILLE": "429203",
  "NOELIE": "123456",
  "VICTOR": "654321",
  "HUGO": "236541"
};

const articles = [
  { nom: "chaise", prix: 10, emoji: "ü™ë" },
  { nom: "Sac Styl√©", prix: 20, emoji: "üéí" },
  { nom: "Lunettes Soleil", prix: 5, emoji: "üï∂Ô∏è" },
  { nom: "Ballon de foot", prix: 5, emoji: "‚öΩ" },
  { nom: "Maxime", prix: 76, img: "https://i.postimg.cc/QMDmBRC5/IMG-20250526-WA0538.jpg" },
  { nom: "Gabriel", prix: 827, img: "https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg" },
  { nom: "Elwen", prix: 937, img: "https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg" },
  { nom: "Panajotis", prix: 246, img: "https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg" },
  { nom: "Alexandre", prix: 903, img: "https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg" },
  { nom: "Stylo", prix: 3, img: "https://i.postimg.cc/pVcmYNnF/79351083-1-ea61-1.jpg"},
  { nom: "Bugatti", prix: 1000, img: "https://i.postimg.cc/bNjM3B2B/875-875-bugatti-chiron-ultime-7544e77c6f8a7a0afe983c01ca597be8.png"},
  { nom: "Enea", prix: 56, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Charlie", prix: 527, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Louis", prix: 666, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Ganzague", prix: 905, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Lenny", prix: 934, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Gr√©goire", prix: 656, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Sullivan", prix: 434, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Ways", prix: 357, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Tom", prix: 482, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Liam", prix: 563, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Wilhelm", prix: 1, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Camille", prix: 176, img:"https://i.postimg.cc/nhMRcFDP/IMG-20250609-WA0004.jpg"},
  { nom: "Mathieu", prix: 430, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"},
  { nom: "Victor", prix: 500, img:"https://i.postimg.cc/76PJg5pN/5472d1b09d3d724228109d381d617326.jpg"}
];

// Custom Modal Functions (replacing alert/confirm/prompt)
function showAlert(message) {
  const modal = document.createElement('div');
  modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] p-4';
  modal.innerHTML = `
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-sm w-full shadow-2xl animate-[scale-in_0.2s_ease-out] transform">
      <p class="text-gray-800 dark:text-gray-200 mb-6 text-base">${message}</p>
      <button class="w-full px-4 py-2 bg-primary hover:bg-primary/80 text-white font-bold rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">
        OK
      </button>
    </div>
  `;
  document.getElementById('modal-container').appendChild(modal);
}

function showConfirm(message, onConfirm) {
  const modal = document.createElement('div');
  modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] p-4';
  modal.innerHTML = `
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-sm w-full shadow-2xl">
      <p class="text-gray-800 dark:text-gray-200 mb-6 text-base">${message}</p>
      <div class="flex gap-3">
        <button class="flex-1 px-4 py-2 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">
          Annuler
        </button>
        <button class="flex-1 px-4 py-2 bg-primary hover:bg-primary/80 text-white font-bold rounded-lg transition-colors" onclick="this.closest('.fixed').remove(); (${onConfirm})()">
          Confirmer
        </button>
      </div>
    </div>
  `;
  document.getElementById('modal-container').appendChild(modal);
}

// Navigation
function toggleMenu() {
  document.getElementById("menu").classList.toggle("hidden");
}

function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.getElementById("menu").classList.add("hidden");
}

function sendWebhook(message) {
  fetch(webhookURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ content: message })
  }).catch(err => console.warn("Erreur Webhook:", err));
}

// Articles
function afficherArticles(liste = articles) {
  const container = document.getElementById("articles-container");
  container.innerHTML = "";
  liste.forEach(article => {
    const div = document.createElement("div");
    div.className = "bg-gradient-to-br from-blue-900 to-cyan-700 rounded-2xl p-6 shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300";

    if (article.img) {
      div.innerHTML = `
        <img src="${article.img}" alt="${article.nom}" class="w-full h-48 object-cover rounded-xl mb-4">
        <h3 class="text-xl font-bold text-white mb-2">${article.nom}</h3>
        <p class="text-2xl font-bold text-yellow-400 mb-4">${article.prix} cailloux</p>
        <button onclick="ajouterAuPanier('${article.nom}', ${article.prix})" class="w-full px-4 py-2 bg-white hover:bg-yellow-400 text-blue-900 font-bold rounded-lg transition-all transform hover:scale-105">
          Ajouter au panier
        </button>
      `;
    } else {
      div.innerHTML = `
        <div class="text-6xl text-center mb-4">${article.emoji}</div>
        <h3 class="text-xl font-bold text-white mb-2 text-center">${article.nom}</h3>
        <p class="text-2xl font-bold text-yellow-400 mb-4 text-center">${article.prix} cailloux</p>
        <button onclick="ajouterAuPanier('${article.nom}', ${article.prix})" class="w-full px-4 py-2 bg-white hover:bg-yellow-400 text-blue-900 font-bold rounded-lg transition-all transform hover:scale-105">
          Ajouter au panier
        </button>
      `;
    }
    container.appendChild(div);
  });
}

function filtrerArticles() {
  const recherche = document.getElementById("recherche").value.toLowerCase();
  const filtres = articles.filter(a => a.nom.toLowerCase().includes(recherche));
  afficherArticles(filtres);
}

// Panier
function ajouterAuPanier(nom, prix) {
  // Demander la quantit√© avec une modale personnalis√©e
  const modal = document.createElement('div');
  modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] p-4';
  modal.innerHTML = `
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-sm w-full shadow-2xl">
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">üõí ${nom}</h3>
      <p class="text-gray-700 dark:text-gray-300 mb-4">Combien voulez-vous en acheter ?</p>
      <input type="number" id="quantity-input" min="1" value="1" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white text-base mb-4 focus:ring-2 focus:ring-primary">
      <div class="flex gap-3">
        <button class="flex-1 px-4 py-2 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">
          Annuler
        </button>
        <button class="flex-1 px-4 py-2 bg-primary hover:bg-primary/80 text-white font-bold rounded-lg transition-colors" onclick="confirmerAjoutPanier('${nom}', ${prix}, parseInt(document.getElementById('quantity-input').value)); this.closest('.fixed').remove()">
          Ajouter
        </button>
      </div>
    </div>
  `;
  document.getElementById('modal-container').appendChild(modal);
  // Focus sur l'input
  setTimeout(() => document.getElementById('quantity-input').focus(), 100);
}

function confirmerAjoutPanier(nom, prix, quantite) {
  if (quantite < 1) quantite = 1;

  const item = panier.find(p => p.nom === nom);
  if (item) {
    item.quantit√© += quantite;
  } else {
    panier.push({ nom, prix, quantit√©: quantite });
  }
  sauvegarderPanier();
  afficherPanier();
  showToast(`${quantite}x ${nom} ajout√©(s) au panier !`, 'success');
}

function calculerTotal() {
  let total = panier.reduce((sum, item) => sum + (item.prix * item.quantit√©), 0);
  if (codeValide) {
    total *= (1 - reduction / 100);
  }
  return Math.round(total);
}

function afficherPanier() {
  const liste = document.getElementById("liste-panier");
  const emptyCart = document.getElementById("empty-cart");
  const totalElement = document.getElementById("total-panier");
  const buyButton = document.getElementById("buy-button");

  const clearButton = document.getElementById("clear-cart-button");

  if (panier.length === 0) {
    emptyCart.classList.remove("hidden");
    liste.classList.add("hidden");
    totalElement.classList.add("hidden");
    buyButton.classList.add("hidden");
    clearButton.classList.add("hidden");
  } else {
    emptyCart.classList.add("hidden");
    liste.classList.remove("hidden");
    totalElement.classList.remove("hidden");
    buyButton.classList.remove("hidden");
    clearButton.classList.remove("hidden");

    liste.innerHTML = "";
    panier.forEach((p, index) => {
      const li = document.createElement("li");
      li.className = "bg-white/5 rounded-lg p-4 mb-2 flex items-center justify-between";
      li.innerHTML = `
        <div class="flex-1">
          <h4 class="font-bold text-white text-lg">${p.nom}</h4>
          <p class="text-yellow-400">${p.prix} cailloux √ó ${p.quantit√©} = ${p.prix * p.quantit√©} cailloux</p>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="modifierQuantite(${index}, -1)" class="bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full font-bold transition-all">‚àí</button>
          <span class="text-white font-bold w-8 text-center">${p.quantit√©}</span>
          <button onclick="modifierQuantite(${index}, 1)" class="bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full font-bold transition-all">+</button>
          <button onclick="retirerDuPanier(${index})" class="ml-2 bg-gray-700 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-all">üóëÔ∏è</button>
        </div>
      `;
      liste.appendChild(li);
    });

    totalElement.textContent = `Total : ${calculerTotal()} cailloux`;
  }
}

// Modifier la quantit√© d'un article
function modifierQuantite(index, change) {
  if (panier[index]) {
    panier[index].quantit√© += change;

    if (panier[index].quantit√© <= 0) {
      retirerDuPanier(index);
    } else {
      sauvegarderPanier();
      afficherPanier();
    }
  }
}

// Retirer un article du panier
function retirerDuPanier(index) {
  const article = panier[index];
  panier.splice(index, 1);
  sauvegarderPanier();
  afficherPanier();
  showToast(`${article.nom} retir√© du panier`, 'info');
}

// Vider le panier
function viderPanier() {
  showConfirm(
    '√ätes-vous s√ªr de vouloir vider votre panier ?',
    function confirmVider() {
      panier = [];
      sauvegarderPanier();
      afficherPanier();
      showToast('Panier vid√© !', 'info');
    }
  );
}

function acheter() {
  if (panier.length === 0) {
    showAlert("Votre panier est vide.");
    return;
  }

  if (!utilisateurConnecte) {
    showAlert("Veuillez vous connecter pour acheter.");
    return;
  }

  // Demander les informations de livraison
  demanderInfosLivraison();
}

function demanderInfosLivraison() {
  const modal = document.createElement('div');
  modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] p-4';
  modal.innerHTML = `
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-md w-full shadow-2xl">
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">üì¶ Informations de livraison</h3>
      <p class="text-gray-700 dark:text-gray-300 mb-6">Pour finaliser votre achat, veuillez remplir ces informations :</p>

      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">üìû Num√©ro de t√©l√©phone</label>
          <input type="text" id="delivery-phone" placeholder="Ex: 06 12 34 56 78" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white text-base focus:ring-2 focus:ring-primary">
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">üè† Adresse de livraison</label>
          <input type="text" id="delivery-address" placeholder="Ex: 123 rue de ton cr√¢ne" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white text-base focus:ring-2 focus:ring-primary">
        </div>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg p-4 mb-6">
        <p class="text-sm text-yellow-800 dark:text-yellow-300">
          ‚ÑπÔ∏è Frais de livraison : <strong>+5%</strong> du total
        </p>
      </div>

      <div id="delivery-error" class="text-red-500 text-sm mb-4 hidden"></div>

      <div class="flex gap-3">
        <button class="flex-1 px-4 py-2 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">
          Annuler
        </button>
        <button class="flex-1 px-4 py-2 bg-primary hover:bg-primary/80 text-white font-bold rounded-lg transition-colors" onclick="validerLivraison()">
          Valider
        </button>
      </div>
    </div>
  `;
  document.getElementById('modal-container').appendChild(modal);
}

function validerLivraison() {
  const phone = document.getElementById('delivery-phone').value.trim();
  const address = document.getElementById('delivery-address').value.trim();
  const errorDiv = document.getElementById('delivery-error');

  // V√©rification : n'importe quelle valeur fonctionne, tant que c'est rempli
  if (!phone || !address) {
    errorDiv.textContent = "Veuillez remplir tous les champs.";
    errorDiv.classList.remove('hidden');
    return;
  }

  // Fermer la modale
  document.querySelector('#modal-container .fixed').remove();

  // Calculer le total avec frais de livraison (5%)
  const totalProduits = calculerTotal();
  const fraisLivraison = Math.round(totalProduits * 0.05);
  const totalFinal = totalProduits + fraisLivraison;

  // V√©rifier le solde
  if (utilisateurs[utilisateurConnecte].solde >= totalFinal) {
    // G√©n√©rer le num√©ro de commande
    const numeroCommande = genererNumeroCommande();

    utilisateurs[utilisateurConnecte].solde -= totalFinal;
    utilisateurs["HARMAN"].solde += totalFinal;

    // Sauvegarder dans l'historique
    if (!historique[utilisateurConnecte]) {
      historique[utilisateurConnecte] = [];
    }
    historique[utilisateurConnecte].push({
      numero: numeroCommande,
      date: new Date().toLocaleString('fr-FR'),
      articles: [...panier],
      total: totalFinal,
      adresse: address,
      telephone: phone
    });

    sendWebhook(`üõí **NOUVELLE COMMANDE**\nüìã Num√©ro: **${numeroCommande}**\nüë§ Client: ${utilisateurConnecte}\nüì¶ Livraison: ${address}\nüìû T√©l: ${phone}\nüí∞ Total produits: ${totalProduits} cailloux\nüöö Frais livraison: ${fraisLivraison} cailloux\n‚úÖ Total final: ${totalFinal} cailloux\n\nüì¶ Articles:\n${panier.map(p => `  ‚Ä¢ ${p.nom} x${p.quantit√©} (${p.prix * p.quantit√©} cailloux)`).join('\n')}`);

    showAlert(`‚úÖ Commande valid√©e avec succ√®s !\n\nüìã NUM√âRO DE COMMANDE :\n${numeroCommande}\n\nüí∞ Total produits : ${totalProduits} cailloux\nüöö Frais de livraison : ${fraisLivraison} cailloux\n‚úÖ TOTAL PAY√â : ${totalFinal} cailloux\n\nüì¶ Livraison √† : ${address}\nüìû Contact : ${phone}\n\n‚ö†Ô∏è Conservez votre num√©ro de commande !`);

    panier = [];
    codeValide = false;
    reduction = 0;
    sauvegarderPanier();
    afficherPanier();
    updateUserDisplay();
    afficherHistorique();
  } else {
    const montantManquant = totalFinal - utilisateurs[utilisateurConnecte].solde;
    showConfirm(
      `Solde insuffisant. Total avec livraison : ${totalFinal} cailloux.<br>Vous manquez ${montantManquant} cailloux.<br><br>Emprunter avec 5% d'int√©r√™t ?`,
      function handleCredit() {
        // G√©n√©rer le num√©ro de commande
        const numeroCommande = genererNumeroCommande();

        const montantAvecInteret = Math.round(montantManquant * 1.05);
        utilisateurs[utilisateurConnecte].solde -= montantAvecInteret;
        utilisateurs["HARMAN"].solde += totalFinal;

        // Sauvegarder dans l'historique
        if (!historique[utilisateurConnecte]) {
          historique[utilisateurConnecte] = [];
        }
        historique[utilisateurConnecte].push({
          numero: numeroCommande,
          date: new Date().toLocaleString('fr-FR'),
          articles: [...panier],
          total: totalFinal,
          adresse: address,
          telephone: phone,
          credit: true
        });

        sendWebhook(`üí≥ **COMMANDE AVEC CR√âDIT**\nüìã Num√©ro: **${numeroCommande}**\nüë§ Client: ${utilisateurConnecte}\nüí∞ Cr√©dit: ${montantAvecInteret} cailloux\nüì¶ Livraison: ${address}\nüìû T√©l: ${phone}\n‚úÖ Total: ${totalFinal} cailloux\n\nüì¶ Articles:\n${panier.map(p => `  ‚Ä¢ ${p.nom} x${p.quantit√©} (${p.prix * p.quantit√©} cailloux)`).join('\n')}`);
        showAlert(`‚úÖ Cr√©dit accord√© ! Commande valid√©e.\n\nüìã NUM√âRO DE COMMANDE :\n${numeroCommande}\n\nüí∞ Total : ${totalFinal} cailloux\nüì¶ Livraison √† : ${address}\n\n‚ö†Ô∏è Conservez votre num√©ro de commande !`);

        panier = [];
        codeValide = false;
        reduction = 0;
        sauvegarderPanier();
        afficherPanier();
        updateUserDisplay();
        afficherHistorique();
      }
    );
  }
}

// Authentication
function toggleClassicLogin() {
  document.getElementById("classic-login-form").classList.toggle("hidden");
}

function handleClassicLogin(event) {
  event.preventDefault();
  const formData = new FormData(event.target);
  const identifiant = formData.get('identifiant').trim().toUpperCase();
  const motDePasse = formData.get('motDePasse').trim();

  if (utilisateurs[identifiant] && utilisateurs[identifiant].motDePasse === motDePasse) {
    login(identifiant);
  } else {
    document.getElementById("login-error").textContent = "Identifiant ou mot de passe incorrect.";
  }
}

function login(username) {
  utilisateurConnecte = username;
  document.getElementById("login-section").classList.add("hidden");
  document.getElementById("user-dashboard").classList.remove("hidden");
  updateUserDisplay();
  afficherHistorique();
  tempQRUser = null;
  showToast(`Bienvenue ${username} ! üëã`, 'success');
}

function logout() {
  utilisateurConnecte = null;
  document.getElementById("login-section").classList.remove("hidden");
  document.getElementById("user-dashboard").classList.add("hidden");
  document.getElementById("order-history").classList.add("hidden");
  showToast('D√©connexion r√©ussie', 'info');
}

// Afficher l'historique des commandes
function afficherHistorique() {
  const historyDiv = document.getElementById("order-history");
  const historyList = document.getElementById("history-list");

  if (!utilisateurConnecte || !historique[utilisateurConnecte] || historique[utilisateurConnecte].length === 0) {
    historyDiv.classList.add("hidden");
    return;
  }

  historyDiv.classList.remove("hidden");
  historyList.innerHTML = '';

  const userOrders = historique[utilisateurConnecte].reverse();

  userOrders.forEach((order, index) => {
    const orderDiv = document.createElement('div');
    orderDiv.className = 'bg-white/5 rounded-lg p-4 mb-4';
    orderDiv.innerHTML = `
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3">
        <div>
          <h4 class="text-xl font-bold text-yellow-400">üìã ${order.numero}</h4>
          <p class="text-sm text-white/70">üïí ${order.date}</p>
        </div>
        <div class="mt-2 md:mt-0">
          <span class="text-2xl font-bold text-white">${order.total} cailloux</span>
          ${order.credit ? '<span class="ml-2 text-xs bg-orange-500 text-white px-2 py-1 rounded">üí≥ Cr√©dit</span>' : ''}
        </div>
      </div>
      <div class="border-t border-white/10 pt-3 mt-3">
        <p class="text-sm text-white mb-2"><strong>üì¶ Articles :</strong></p>
        <ul class="text-sm text-white/80 space-y-1 ml-4">
          ${order.articles.map(a => `<li>‚Ä¢ ${a.nom} x${a.quantit√©} (${a.prix * a.quantit√©} cailloux)</li>`).join('')}
        </ul>
        <p class="text-sm text-white mt-3"><strong>üè† Adresse :</strong> ${order.adresse}</p>
        <p class="text-sm text-white"><strong>üìû T√©l√©phone :</strong> ${order.telephone}</p>
      </div>
    `;
    historyList.appendChild(orderDiv);
  });
}

function updateUserDisplay() {
  if (utilisateurConnecte) {
    document.getElementById("user-name").textContent = utilisateurConnecte;
    document.getElementById("user-balance").textContent = utilisateurs[utilisateurConnecte].solde.toLocaleString('fr-FR');
  }
}

// QR Scanner
function startQRScanner() {
  qrScannerActive = true;
  document.getElementById("qr-scanner-overlay").classList.remove("hidden");
  document.getElementById("scan-message").textContent = "Initialisation...";

  navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
    .then(stream => {
      const video = document.getElementById("qr-video");
      video.srcObject = stream;
      video.play();
      document.getElementById("scan-message").textContent = "Placez le QR code dans le cadre";
      scanQRCode();
    })
    .catch(err => {
      console.error('Erreur cam√©ra:', err);
      document.getElementById("scan-message").textContent = "Impossible d'acc√©der √† la cam√©ra.";
    });
}

function scanQRCode() {
  if (!qrScannerActive) return;

  const video = document.getElementById("qr-video");
  const canvas = document.getElementById("qr-canvas");
  const context = canvas.getContext('2d');

  if (video.readyState < video.HAVE_ENOUGH_DATA) {
    animationId = requestAnimationFrame(scanQRCode);
    return;
  }

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  context.drawImage(video, 0, 0, canvas.width, canvas.height);

  const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
  let code = null;

  try {
    code = jsQR(imageData.data, imageData.width, imageData.height);
  } catch (e) {
    console.error("Erreur jsQR:", e);
  }

  if (code) {
    handleQRCodeDetected(code.data);
    return;
  }

  if (qrScannerActive) {
    animationId = requestAnimationFrame(scanQRCode);
  }
}

function handleQRCodeDetected(qrData) {
  const userId = qrData.trim().toUpperCase();

  if (utilisateurs[userId]) {
    stopQRScanner();

    if (qrSecretCodes[userId]) {
      tempQRUser = userId;
      document.getElementById("qr-user-prompt").textContent = `Veuillez entrer votre code secret pour ${userId}.`;
      document.getElementById("qr-code-verification-overlay").classList.remove("hidden");
    } else {
      login(userId);
      sendWebhook(`üîç Connexion QR simple pour ${userId}`);
    }
  } else {
    document.getElementById("scan-message").textContent = `Code QR invalide: ${userId}`;
    setTimeout(() => {
      document.getElementById("scan-message").textContent = "Placez le QR code dans le cadre";
    }, 2000);
  }
}

function handleQRVerify(event) {
  event.preventDefault();
  const codeSecret = document.getElementById("qr-secret-code").value.trim();
  const errorDiv = document.getElementById("qr-verify-error");

  if (!tempQRUser) {
    errorDiv.textContent = "Erreur: Utilisateur QR non d√©fini.";
    return;
  }

  if (qrSecretCodes[tempQRUser] === codeSecret) {
    document.getElementById("qr-code-verification-overlay").classList.add("hidden");
    login(tempQRUser);
    sendWebhook(`‚úÖ Connexion QR avec code secret pour ${tempQRUser}`);
    document.getElementById("qr-secret-code").value = '';
  } else {
    errorDiv.textContent = "Code secret incorrect.";
  }
}

function cancelQRVerify() {
  tempQRUser = null;
  document.getElementById("qr-secret-code").value = '';
  document.getElementById("qr-verify-error").textContent = '';
  document.getElementById("qr-code-verification-overlay").classList.add("hidden");
}

function stopQRScanner() {
  qrScannerActive = false;

  if (animationId) {
    cancelAnimationFrame(animationId);
  }

  const video = document.getElementById("qr-video");
  if (video.srcObject) {
    video.srcObject.getTracks().forEach(track => track.stop());
  }

  document.getElementById("qr-scanner-overlay").classList.add("hidden");
}

// Transfers
function envoyerCailloux(event) {
  event.preventDefault();
  const formData = new FormData(event.target);
  const destinataire = formData.get('destinataire').trim().toUpperCase();
  const montant = parseInt(formData.get('montant'));

  if (utilisateurs[destinataire] && montant > 0 && utilisateurs[utilisateurConnecte].solde >= montant) {
    utilisateurs[utilisateurConnecte].solde -= montant;
    utilisateurs[destinataire].solde += montant;

    showToast(`Virement de ${montant} cailloux effectu√© vers ${destinataire} ‚úÖ`, 'success');
    sendWebhook(`üí∏ Virement de ${montant} cailloux de ${utilisateurConnecte} √† ${destinataire}.`);
    updateUserDisplay();
    event.target.reset();
  } else {
    showToast('Erreur : destinataire inconnu ou solde insuffisant', 'error');
  }
}

// Creator codes
function handleCodeInput(event) {
  if (event.key === 'Enter') {
    const code = event.target.value.trim().toUpperCase();
    const successDiv = document.getElementById("code-success");

    if (codes[code]) {
      codeValide = true;
      reduction = codes[code];
      successDiv.textContent = `‚úÖ Code valid√© ! ${reduction}% de r√©duction`;
      successDiv.classList.remove("hidden");
      afficherPanier();
      showToast(`Code promo activ√© : -${reduction}% ! üéâ`, 'success');
    } else {
      codeValide = false;
      reduction = 0;
      successDiv.classList.add("hidden");
      showToast("Code promo invalide", 'error');
    }
    event.target.value = '';
  }
}

// Init
document.addEventListener('DOMContentLoaded', function() {
  // Afficher l'√©cran de chargement pendant 5 secondes
  setTimeout(() => {
    const loadingScreen = document.getElementById('loading-screen');
    loadingScreen.style.opacity = '0';
    loadingScreen.style.transition = 'opacity 0.5s ease-out';
    setTimeout(() => {
      loadingScreen.remove();
    }, 500);
  }, 5000);

  afficherArticles();
  afficherPanier();
  updateCartBadge();
  sendWebhook("üëÄ Nouvelle visite sur **JOLIE PAS CHER** !");
});
</script>

</body>
</html>
